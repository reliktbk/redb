```markdown
# redb: Кросс-платформенная система управления базами данных

redb — это легковесная и масштабируемая система управления базами данных (СУБД), разработанная для обеспечения бесшовной работы с PostgreSQL, MSSQL и SQLite.  Проект написан на C# с использованием .NET 8.0.4 и ряда современных технологий, что обеспечивает высокую производительность и гибкость.

## Ключевые особенности:

* **Кросс-платформенность:** redb работает с тремя популярными СУБД без необходимости значительной переделки кода приложения.  Это достигается за счет использования стандартизированного SQL и избегания проприетарных функций.
* **Масштабируемость:**  redb спроектирован с учетом горизонтального масштабирования.  Вы можете легко обрабатывать большие объемы данных путем добавления новых узлов или серверов.
* **Простота использования:**  Простой и интуитивно понятный интерфейс позволяет быстро освоить систему и начать работу.  redb ориентирован на разработчиков, которым нужна надежная и удобная СУБД.
* **Эффективность:** Несмотря на свою легковесность, redb обеспечивает высокую производительность благодаря использованию оптимизированных алгоритмов и современных технологий.
* **Реляционная модель данных:**  redb использует проверенную временем реляционную модель данных, что гарантирует целостность и надежность хранимой информации.


## Технологический стек:

* **C# (.NET 8.0.4)**
* **EF Core**
* **LINQ**
* **Lambda expressions**
* **Razor**
* **MVC**
* **DevExtreme UI**
* **Web API**
* **Dependency Injection (DI)**
* **jQuery**
* **Docker**


## Архитектура:

redb использует относительно простую, но эффективную архитектуру, состоящую из небольшого количества таблиц. Это обеспечивает гибкость и  легкость в сопровождении.  Подробная информация об архитектуре доступна в исходном коде проекта.


## Как начать работу:

1. Клонируйте репозиторий: `git clone https://github.com/reliktbk/redb.git`
2. (Инструкции по установке и запуску будут добавлены позже)


## Лицензия:

[MIT License](LICENSE)


## Вклад в проект:

Мы приветствуем вклад в развитие redb!  Пожалуйста, ознакомьтесь с [CONTRIBUTING.md](CONTRIBUTING.md) для получения дополнительной информации.
```
 
 # Анализ SQL схемы базы данных   https://github.com/reliktbk/redb/blob/master/redb.Core.Postgres/sql/redbPostgre.sql

Этот SQL код описывает создание сложной схемы базы данных, предназначенной для хранения иерархических данных с поддержкой контроля доступа и аудита.  Схема включает в себя механизмы для отслеживания изменений и управления правами.

## Структура кода

Код можно разделить на следующие логические блоки:

1. **Удаление существующих объектов:**  Начальный блок кода удаляет все таблицы и последовательность, если они уже существуют.  Это обеспечивает чистоту при повторном создании схемы.

2. **Создание таблиц:**  Основная часть кода, включающая создание 14 таблиц.

3. **Индексы:**  Блок создания индексов для оптимизации производительности запросов.

4. **Триггер и функция:**  Определяет триггер `TR__objects__deleted_objects` и функцию `ftr__objects__deleted_objects()`. Этот триггер автоматически запускается перед удалением объекта из таблицы `_objects`, архивируя его в таблице `_deleted_objects`.  Функция выполняет агрегацию данных, используя JSON-функции PostgreSQL.

5. **Последовательность:**  Создает последовательность `global_identity` для генерации уникальных идентификаторов.

6. **Заполнение таблицы типов:**  Вставка начальных данных в таблицу `_types`, определяющую типы данных системы.


## Ключевые таблицы и их взаимосвязи

Схема построена вокруг центральной таблицы `_objects`, которая хранит основные данные.  Другие таблицы обеспечивают дополнительную функциональность:

* **`_types`**:  Определяет типы данных, используемые в системе (Boolean, DateTime, Double, ListItem, Guid, Long, Object, Text, ByteArray, String).

* **`_links`**:  Реализует связи "многие-ко-многим" между объектами.

* **`_lists`**:  Хранит списки.

* **`_roles`**:  Определяет роли пользователей (например, "администратор", "пользователь").

* **`_users`**:  Таблица пользователей с информацией об учетных данных и профиле.

* **`_users_roles`**:  Связующая таблица для реализации много-к-многим отношений между пользователями и ролями.

* **`_schemes`**:  Представляет иерархическую структуру схем данных.

* **`_structures`**:  Описывает структуру данных внутри схемы, включая типы полей, ограничения и настройки отображения.

* **`_dependencies`**:  Определяет зависимости между схемами, обеспечивая целостность данных.

* **`_objects`**:  Хранит основные данные объектов, указывая на схему, владельца, дату создания и изменения, а также другие метаданные.

* **`_deleted_objects`**:  Архивная таблица для хранения удаленных объектов.  Включает все поля из `_objects`, дату удаления и сериализованные значения объекта.

* **`_list_items`**:  Содержит элементы списков, связывая их с объектами.

* **`_values`**:  Хранит фактические значения атрибутов объектов, связанные со структурой.

* **`_permissions`**:  Управляет правами доступа пользователей и ролей к объектам.

* **`_functions`**:  Позволяет хранить пользовательские функции, расширяющие функционал базы данных.

**Взаимосвязи:**  Между таблицами установлены связи `FOREIGN KEY`, обеспечивающие целостность данных и каскадное удаление ( `ON DELETE CASCADE`).


## Триггер и функция архивирования (`TR__objects__deleted_objects` и `ftr__objects__deleted_objects()`)

Триггер `TR__objects__deleted_objects` запускается перед удалением записи из `_objects`. Он вызывает функцию `ftr__objects__deleted_objects()`, которая копирует данные удаляемого объекта и его значений в архивную таблицу `_deleted_objects`. При этом используется агрегация данных с помощью JSON-функций для сохранения всех значений в поле `_values` в виде сериализованного JSON-объекта.  Это позволяет восстанавливать удаленные объекты, а также отслеживать историю изменений.


## Индексы

Большое количество индексов (`CREATE INDEX IF NOT EXISTS ...`) значительно улучшает производительность запросов, ускоряя поиск и сортировку данных по часто используемым полям.


## Заключение

Данный SQL код описывает хорошо продуманную и масштабируемую схему базы данных, пригодную для хранения сложных иерархических данных с поддержкой аудита и контроля доступа. Использование триггеров и JSON-функций повышает функциональность, а наличие индексов оптимизирует производительность.